<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kabanos Game</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <section id="rulesSection">
    <h1>ğŸ“œ SpÄ“les noteikumi</h1>
    <p>ğŸ’¡ SavÄc brÅ«nos kabanoÅ¡us, lai iegÅ«tu punktus.</p>
    <p>ğŸ¥¦ Izvairies no zaÄ¼ajiem brokoÄ¼iem, tie atÅ†em dzÄ«vÄ«bas.</p>
    <p>ğŸ’” Ja paliek 0 dzÄ«vÄ«bu â€” spÄ“le beidzas!</p>
    <button id="rulesNextBtn">TÄlÄk</button>
  </section>

  <section id="nameInputSection" style="display:none;">
    <h1>ğŸ‘¤ Ievadi savu vÄrdu</h1>
    <input type="text" id="playerName" placeholder="Tavs vÄrds" />
    <button id="confirmNameBtn">ApstiprinÄt</button>
  </section>

  <section id="gameScreen" style="display:none;">
    <div class="hud">
      <span>ğŸ’¯ Punkti: <span id="score">0</span></span>
      <span>â¤ï¸ DzÄ«vÄ«bas: <span id="lives">3</span></span>
    </div>
    <div id="game">
      <div id="player"></div>
    </div>
    <button id="startGameBtn">SÄkt spÄ“li</button>
  </section>

  <div id="gameOverModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" id="closeModalBtn">&times;</span>
      <h2>â˜ ï¸ SpÄ“le beigusies</h2>
      <p><strong id="finalPlayerName"></strong>, tavi punkti: <strong id="finalScore"></strong></p>
      <button id="restartGameBtn">SÄkt no jauna</button>
      <button id="showLeaderboardBtn">ğŸ† SkatÄ«t rezultÄtus</button>
    </div>
  </div>

  <div id="leaderboardModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" id="closeLeaderboard">&times;</span>
      <h2>ğŸ† LÄ«deru saraksts</h2>
      <ul id="leaderboardList"></ul>
    </div>
  </div>

  <script>
    const rulesSection = document.getElementById('rulesSection');
    const rulesNextBtn = document.getElementById('rulesNextBtn');
    const nameInputSection = document.getElementById('nameInputSection');
    const playerNameInput = document.getElementById('playerName');
    const confirmNameBtn = document.getElementById('confirmNameBtn');
    const gameScreen = document.getElementById('gameScreen');
    const startGameBtn = document.getElementById('startGameBtn');
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const gameOverModal = document.getElementById('gameOverModal');
    const finalPlayerNameSpan = document.getElementById('finalPlayerName');
    const finalScoreSpan = document.getElementById('finalScore');
    const restartGameBtn = document.getElementById('restartGameBtn');
    const showLeaderboardBtn = document.getElementById('showLeaderboardBtn');
    const leaderboardModal = document.getElementById('leaderboardModal');
    const closeLeaderboardBtn = document.getElementById('closeLeaderboard');
    const leaderboardList = document.getElementById('leaderboardList');

    let playerName = '';
    let score = 0;
    let lives = 3;
    let gameInterval;
    let gameStarted = false;
    let itemsFallIntervals = [];

    rulesNextBtn.onclick = () => {
      rulesSection.style.display = 'none';
      nameInputSection.style.display = 'block';
    };

    confirmNameBtn.onclick = () => {
      const name = playerNameInput.value.trim();
      if (!name) {
        alert('LÅ«dzu, ievadiet vÄrdu!');
        return;
      }
      playerName = name;
      nameInputSection.style.display = 'none';
      gameScreen.style.display = 'block';
      startGameBtn.style.display = 'inline-block';
    };

    startGameBtn.onclick = () => {
      startGameBtn.style.display = 'none';
      startGame();
    };

    function startGame() {
      score = 0;
      lives = 3;
      updateHUD();
      clearItems();
      player.style.left = (game.clientWidth - player.clientWidth) / 2 + 'px';
      if (gameInterval) clearInterval(gameInterval);
      gameInterval = setInterval(dropItem, 1000);
      gameStarted = true;
    }

    function updateHUD() {
      scoreEl.textContent = score;
      livesEl.textContent = lives;
    }

    function clearItems() {
      itemsFallIntervals.forEach(i => clearInterval(i));
      itemsFallIntervals = [];
      document.querySelectorAll('.item').forEach(i => i.remove());
    }

    function dropItem() {
      const item = document.createElement('div');
      const isKabanos = Math.random() < 0.7;
      item.classList.add('item', isKabanos ? 'kabanos' : 'brokoli');
      item.style.left = Math.random() * (game.clientWidth - 30) + 'px';
      game.appendChild(item);

      let top = 0;
      const fall = setInterval(() => {
        top += 5;
        item.style.top = top + 'px';

        const itemRect = item.getBoundingClientRect();
        const playerRect = player.getBoundingClientRect();

        if (
          itemRect.bottom >= playerRect.top &&
          itemRect.left < playerRect.right &&
          itemRect.right > playerRect.left
        ) {
          clearInterval(fall);
          item.remove();
          if (item.classList.contains('kabanos')) {
            score++;
          } else {
            lives--;
          }
          updateHUD();
          if (lives <= 0) endGame();
        } else if (top > game.clientHeight) {
          clearInterval(fall);
          item.remove();
          if (item.classList.contains('kabanos')) {
            lives--;
            updateHUD();
            if (lives <= 0) endGame();
          }
        }
      }, 30);

      itemsFallIntervals.push(fall);
    }

    function endGame() {
      gameStarted = false;
      clearInterval(gameInterval);
      clearItems();
      saveScore(playerName, score);
      finalPlayerNameSpan.textContent = playerName;
      finalScoreSpan.textContent = score;
      gameOverModal.style.display = 'block';
    }

    restartGameBtn.onclick = () => {
      gameOverModal.style.display = 'none';
      startGameBtn.style.display = 'inline-block';
    };

    showLeaderboardBtn.onclick = () => {
      gameOverModal.style.display = 'none';
      showLeaderboardModal();
    };

    function saveScore(name, score) {
      let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
      leaderboard.push({ name, score });
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 10);
      localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
    }

    function showLeaderboardModal() {
      leaderboardList.innerHTML = '';
      let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
      if (leaderboard.length === 0) {
        leaderboardList.innerHTML = '<li>Nav ierakstu</li>';
      } else {
        leaderboard.forEach((entry, i) => {
          const li = document.createElement('li');
          li.textContent = `${i + 1}. ${entry.name} - ${entry.score}`;
          leaderboardList.appendChild(li);
        });
      }
      leaderboardModal.style.display = 'block';
    }

    closeLeaderboardBtn.onclick = () => {
      leaderboardModal.style.display = 'none';
    };

    let moveLeft = false;
    let moveRight = false;

    document.addEventListener('keydown', (e) => {
      if (!gameStarted) return;
      if (e.key === 'ArrowLeft') moveLeft = true;
      if (e.key === 'ArrowRight') moveRight = true;
    });

    document.addEventListener('keyup', (e) => {
      if (!gameStarted) return;
      if (e.key === 'ArrowLeft') moveLeft = false;
      if (e.key === 'ArrowRight') moveRight = false;
    });

    function movePlayer() {
      if (gameStarted) {
        const left = parseInt(player.style.left || '0');
        if (moveLeft && left > 0) {
          player.style.left = (left - 5) + 'px';
        }
        if (moveRight && left < game.clientWidth - player.clientWidth) {
          player.style.left = (left + 5) + 'px';
        }
      }
      requestAnimationFrame(movePlayer);
    }
    movePlayer();

    game.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const touchX = e.touches[0].clientX;
      movePlayerTo(touchX);
    });

    game.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touchX = e.touches[0].clientX;
      movePlayerTo(touchX);
    });

    function movePlayerTo(clientX) {
      const gameRect = game.getBoundingClientRect();
      let newLeft = clientX - gameRect.left - player.clientWidth / 2;
      if (newLeft < 0) newLeft = 0;
      if (newLeft > game.clientWidth - player.clientWidth) {
        newLeft = game.clientWidth - player.clientWidth;
      }
      player.style.left = newLeft + 'px';
    }
  </script>
</body>
</html>
